# PBsolver
A 1D solver for Poisson-Boltzmann Equation

This is a python library for a 1D Poisson-Boltzmann solver. The code is currently being developed for improved functionality.

Right now the library offers three functions each used for a specific type of problem.


# DEPENDENCIES:

These python modules must be available in your system to use this library

1. python3-numpy

2. python3-matplotlib

3. python3-scipy

4. python3-progressbar

Add the repository to your $PYTHONPATH with

$ export PYTHONPATH=$PYTHONPATH:/path/to/PBsolver/

and also add this line to your ~/.bashrc or whichever shell you are using.

** ALL INPUTS ARE GIVEN IN SI UNITS UNLESS OTHERWISE SPECIFIED **


# FUNCTIONS:

## 1. steadyState_1D

### Description: 

A 1D PB solver for a system with static and movable charges

### Inputs:

#### Required:

NPSD = Number of Points in Spacial Discretization

L = Total Length of the system

tol = Tolerance value for Numerical Solution

T = Absolute Temperature 

rel_perm = Relative permitivity for the medium

pos_ions = A 2D python list containing all the Positive ions contributions with each inner list containing the bulk charge density, the lower bound (In fraction of system length 'L'), the upper bound (In fraction of system length 'L') and weather its movable or not. (See ToyModel Example for details)

neg_ions = A 2D python list containing all the Negative ions contributions with each inner list containing the bulk charge density, the lower bound (In fraction of system length 'L'), the upper bound (In fraction of system length 'L') and weather its movable or not. (See ToyModel Example for details)

#### Optional:

NeuBC = Electric Field present at the left boundary. Default = 0.0

grid = grid symmetry either cartersian 'C' or spherical 'S'. Default is 'S'
    
### Outputs: 

Plots the Electric Potential, Electric Field and concentration profile of mobile ions in the whole system

### Example:

See the example ToyModel.ph
To understand how the charges are defined, lets see the line 

                "pos_ions = [[1e-4,0.1,1.0,True],[1e-3,0.0,0.1,False]]"

Here the positive ion contributions are defined in a python list where there are total two contributions. Each contribution is itself a list nested in the main list. There are total 4 elements in each inner list. The first one is the charge density in the zero-field state of meaning the charge density of teh species if the electric potential is zero. The second and thord value correspond to the region where this charge is present initially and given in the fraction of the system length 'L' so valid values are only from '0.0' to '1.0' where '0.0' denotes the left boundary and '1.0' denotes the right boundary. The final value is a boolean where True define a moveable charge contribution and False define a static charge contribution which does not move under the influence of electric field. 
The toy model consist of a uniform charged sphere with constant charge density surrounded by an electrolyte containing positive and negative charges. The uniform charged sphere is defined as the second contribution in this pos_ions list while the first contribution is the positive ions in the electrolytes, which move under the influence of the electric field generated by the system.





## 2. steadyState_1D_silanoDL

### Description: 

A steady state 1D Poisson-Boltsmann solver for study of double layer on silica surface.

### Inputs:

#### Required:
        
NPSD = Number of Points in Spacial Discretization

L = Total Length of the system

tol = Tolerance value for Numerical Solution

T = Absolute Temperature 

rel_perm = Relative permitivity for the medium

ion_conc = Python list of Concentrations of salt in the electrolyte to solve the model for

pH = Python list of pH values to solve the model for

surf_states = Python list of maximum density of surface states to solve the model for (in numbers per m^2)

K1 = Equilibrium constant for single protonation reaction in per Molar

K2 = Equilibrium constant for double protonation reaction in per Molar

#### Optional

shelf_loc = A python string for a folder location to save data and result plots. Default = './'

title = A python string of title for the calculation run. Default = 'Untitled'

steric = Include steric effects or not? Default = True

eff_sizes = Effective sizes of ions for steric effect in a 4-element python list containing values of positive ion, negative ion, proton, counter-ion of protons in that order

force_new_calc = Force new calculation even if data file with same title already exist. Default = False

plot = Plot the Results. Default = True

stern_size = size of the stern layer in angstrom

    
### Outputs: 

Saves a number of plots at the location provided along with a python shelf object with all the data stored that can later be used with the function Steady_1D_silanoDL_plot(shelf_file, title) to plot the data again. The plotted data are Electrostatics for each case, the surface potential and charge states density for the three states, and the Potential as well as pH change for differnet bulk pH values.

Also return a tuple of calculated data on spatial grid : (Space grid, Potential, Positive Ion Concentration, Proton Concentration, Negative Ion Concentration, Concentration of counter-ion of proton, [SiO-] surface density, [SiOH] surface density, [SiOH2+] surface density)

All returned objects are multidimentional numpy arrays where the first, second and third dimension represent values on bulk ionic concentration, maximum surface states density and bulk pH respectively. Except for the last three arrays, the fourth dimension represent the spatial grid point.
**Note : All indexes start from zero

### Example:

See the example file PHsensor.py

Most of the inputs are clear. The input pH, surf_states and ionic_conc must be python lists containing all the values for which the calculations should be done. Like in the example, the calculation is done for three differnet salt concentrations, three different surface states density and five different value of pH. The inputs 'shelf_loc' must be a string of absolute location of a directory like "/home/usr/temp" or "/usr/temp" otherwise it will save the data and plots in the current directory. 'title' gives the calculation run a name for the save data file and plots directory.




## 3. timeInt_1D_sensor
    

### Description: 
        
This is time integration of a diffusion model of a bio reactor with a sensor capturing antibody molecules at one end

### Inputs:

#### Required:

Length = Total Length of the system

Duration = Total Duration of the system

Kon = Capturing rate of the sensor in m^3/mole*sec

Koff = Releasing rate of the sensor in 1/sec

Ntotal = Total number of capture sites on the sensor

A_total = Area of the sensor surface

c_bulk = The bulk concentration of the antibody molecules

#### Optional:

D_const = Diffusion coefficient of the system. Default = 10^-9 m^2/sec

Ng = Number of concentration profiles to be plotted (Will be plotted after regular interval of time). Default = 10

points_per_m = Number of grid points used for one meter on the system. This model is converged on the default value so there should not be a reason to change it. Default = 20000 points/m

points_per_sec = Number of grid points used for one sec on the time integration. This model is converged on the default value so there should not be a reason to change it. Default = 30 points/sec

Kp =  Probability (given in fraction) that a captured antibody produce a signal and the signal is observed. Default = 1.0


### Outputs:

Plots Ng concentration profiles of the whole system after regular intervals of the time integration. Also plots the occupied surface states of the sensor over the duration of the simulation.



## Warnings:

** The arguments are not yet robust because there is no checking of inputs implemented yet so a wrong or unphysical values may still produce results so check the input values. **

